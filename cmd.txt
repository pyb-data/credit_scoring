#### DEBUT
https://www.youtube.com/watch?v=-Gc8CMjQZfc
Create EC2 instance - Deploy Flask application on EC2 p.1


sudo apt-get update
sudo apt-get install python3-pip
sudo apt-get install unzip
sudo apt-get install nginx
sudo apt-get install gunicorn3

sudo pip3 install flask

unzip projet_7.zip

cd projet_7
sudo mv projet_7 /etc/nginx/sites-enabled/projet_7

pip3 install Cython
pip3 install streamlit

pip3 install -r requirements.txt

#sudo service nginx restart
cd
cd projet_7
gunicorn3 app:app


streamlit run dashboard.py

#### FIN



# ERREUR STREAMLIT

  -- Running cmake for pyarrow
  cmake -DPYTHON_EXECUTABLE=/usr/bin/python3 -DPython3_EXECUTABLE=/usr/bin/python3  -DPYARROW_BUILD_CUDA=off -DPYARROW_BUILD_FLIGHT=off -DPYARROW_BUILD_GANDIVA=off -DPYARROW_BUILD_DATASET=off -DPYARROW_BUILD_ORC=off -DPYARROW_BUILD_PARQUET=off -DPYARROW_BUILD_PLASMA=off -DPYARROW_BUILD_S3=off -DPYARROW_BUILD_HDFS=off -DPYARROW_USE_TENSORFLOW=off -DPYARROW_BUNDLE_ARROW_CPP=off -DPYARROW_BUNDLE_BOOST=off -DPYARROW_GENERATE_COVERAGE=off -DPYARROW_BOOST_USE_SHARED=on -DPYARROW_PARQUET_USE_SHARED=on -DCMAKE_BUILD_TYPE=release /tmp/pip-build-crdjei96/pyarrow
  unable to execute 'cmake': No such file or directory
  error: command 'cmake' failed with exit status 1
  
  ----------------------------------------
  Failed building wheel for pyarrow
  Running setup.py clean for pyarrow
Failed to build pyarrow








    -- Running cmake for pyarrow
    cmake -DPYTHON_EXECUTABLE=/usr/bin/python3 -DPython3_EXECUTABLE=/usr/bin/python3  -DPYARROW_BUILD_CUDA=off -DPYARROW_BUILD_FLIGHT=off -DPYARROW_BUILD_GANDIVA=off -DPYARROW_BUILD_DATASET=off -DPYARROW_BUILD_ORC=off -DPYARROW_BUILD_PARQUET=off -DPYARROW_BUILD_PLASMA=off -DPYARROW_BUILD_S3=off -DPYARROW_BUILD_HDFS=off -DPYARROW_USE_TENSORFLOW=off -DPYARROW_BUNDLE_ARROW_CPP=off -DPYARROW_BUNDLE_BOOST=off -DPYARROW_GENERATE_COVERAGE=off -DPYARROW_BOOST_USE_SHARED=on -DPYARROW_PARQUET_USE_SHARED=on -DCMAKE_BUILD_TYPE=release /tmp/pip-build-crdjei96/pyarrow
    unable to execute 'cmake': No such file or directory
    error: command 'cmake' failed with exit status 1
    
    ----------------------------------------



    ----------------------------------------
Command "/usr/bin/python3 -u -c "import setuptools, tokenize;__file__='/tmp/pip-build-crdjei96/pyarrow/setup.py';f=getattr(tokenize, 'open', open)(__file__);code=f.read().replace('\r\n', '\n');f.close();exec(compile(code, __file__, 'exec'))" install --record /tmp/pip-u0siykdi-record/install-record.txt --single-version-externally-managed --compile --user --prefix=" failed with error code 1 in /tmp/pip-build-crdjei96/pyarrow/














#Apache:
sudo apt-get install apache2
sudo apt-get install libapache2-mod-wsgi


#Virtual env:
python3 -m venv env
source env/bin/activate
export FLASK_APP=app
export FLASK_ENV=development
flask run

sur flask
https://www.twilio.com/blog/how-run-flask-application



#elastic beanstalk
https://docs.aws.amazon.com/elasticbeanstalk/latest/dg/create-deploy-python-flask.html
https://github.com/aws/aws-elastic-beanstalk-cli-setup
apt-get install \
    build-essential zlib1g-dev libssl-dev libncurses-dev \
    libffi-dev libsqlite3-dev libreadline-dev libbz2-dev
git clone https://github.com/aws/aws-elastic-beanstalk-cli-setup.git
./aws-elastic-beanstalk-cli-setup/scripts/bundled_installer

# pour "vraiment" finir l'installation de eb
pip install --upgrade pip
pip install --upgrade awsebcli


# pour lancer eb init, il faut ssh-keygen
https://docs.aws.amazon.com/elasticbeanstalk/latest/dg/eb3-init.html
https://docs.aws.amazon.com/elasticbeanstalk/latest/dg/eb3-ssh.html
https://aws.amazon.com/fr/blogs/security/wheres-my-secret-access-key/


# créé application EC2
eb init -p python-3.6 flask-tutorial --region us-east-2

error.....



timeout sur EB
https://stackoverflow.com/questions/49137188/aws-elastic-beanstalk-504-gateway-timeout
https://aws.amazon.com/fr/premiumsupport/knowledge-center/elastic-beanstalk-configuration-files/
https://docs.aws.amazon.com/elasticbeanstalk/latest/dg/ebextensions.html
https://jaxenter.com/troubleshooting-aws-elastic-beanstalk-134700.html

    from pickle import dump
    a=1
    #dump(a,open('/home/ubuntu/pythonapp/a.pkl','wb'))


# Déploiement sur EC2

https://www.twilio.com/blog/deploy-flask-python-app-aws



Préparation clé
dans .ssh:
chmod 600 ./projet_7.pem
ssh-add ./projet_7.pem

Connexion
ssh ubuntu@ec2-15-188-193-18.eu-west-3.compute.amazonaws.com
ssh -i "projet_7.pem" ubuntu@ec2-15-188-193-18.eu-west-3.compute.amazonaws.com













sudo rsync -rv /home/pierre/Documents/test-aws-basique/ ubuntu@ec2-15-188-193-18.eu-west-3.compute.amazonaws.com:/home/flaskapp
scp /home/pierre/Documents/test-aws-basique/ ubuntu@ec2-15-188-193-18.eu-west-3.compute.amazonaws.com:/home/flaskapp



https://www.codementor.io/@jqn/deploy-a-flask-app-on-aws-ec2-13hp1ilqy2
https://digitalvarys.com/how-to-deploy-python-flask-application-on-aws-ec2/


ça marche!!!
https://syam.space/tech-tips/how-to-deploy-flask-app-on-aws-ec2/

 à creuser 
https://medium.com/shapeai/deploying-flask-application-with-ml-models-on-aws-ec2-instance-3b9a1cec5e13
https://towardsdatascience.com/machine-learning-web-application-deployment-in-5-steps-d8eb6a389cdd




Issue intalling streamlit
https://discuss.streamlit.io/t/cant-install-streamlit-on-ubuntu-20-04-running-under-wsl-2-0-on-a-surface-pro-x/8817/3

ça marche!
python3 -m pip install streamlit
https://blog.jcharistech.com/2019/10/29/how-to-deploy-streamlit-apps-on-aws-ec2/
install anaconda
https://wszhan.github.io/2018/04/09/installing-anaconda-on-ec2.html
https://fr.apis.support.brightcove.com/general/use-insomnia-api-requests.html


